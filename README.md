# üõ°Ô∏è Security Report Application

Aplica√ß√£o desktop standalone para gest√£o de incidentes de seguran√ßa desenvolvida com Flutter + SQLite.

## üìã Sobre o Projeto

Sistema completo de gest√£o de incidentes de seguran√ßa com autentica√ß√£o Argon2id, base de dados SQLite local criptografada, gest√£o de sess√µes com JWT, e funcionalidades avan√ßadas de relat√≥rios, auditoria e notifica√ß√µes in‚Äëapp.

### ‚ú® Funcionalidades Principais

- üîê **Autentica√ß√£o Segura**: Sistema de login com Argon2id password hashing (winner do Password Hashing Competition 2015)
- üîí **Criptografia End-to-End**: Exports PDF/CSV criptografados com AES-256
- üìä **Dashboard Interativo**: Visualiza√ß√£o de incidentes com gr√°ficos (fl_chart)
- üóÑÔ∏è **Base de Dados Local**: SQLite com prote√ß√£o contra SQL injection
- üìù **Gest√£o de Incidentes**: CRUD completo com categoriza√ß√£o e n√≠veis de risco
- üë• **Gest√£o de Utilizadores**: Cria√ß√£o e gest√£o de t√©cnicos e administradores
- üìÑ **Exporta√ß√£o Segura**: Relat√≥rios criptografados em PDF e CSV (AES-256)
- üîç **Auditoria**: Log completo com mascaramento de dados sens√≠veis
- üõ°Ô∏è **Input Sanitization**: Prote√ß√£o contra XSS, SQL injection e path traversal
- üîî **Notifica√ß√µes In-App**: Painel r√°pido de notifica√ß√µes (√≠cone no topo), com marca√ß√£o como lidas

## üöÄ Tecnologias Utilizadas

### Core
- **Flutter 3.35.6** - Framework UI (Windows, Linux, macOS, Android, iOS)
- **Dart 3.9.2** - Linguagem de programa√ß√£o
- **SQLite** - Base de dados local (Desktop via FFI, Mobile via sqflite)

### Depend√™ncias Principais
| Pacote | Vers√£o | Finalidade |
|--------|--------|------------|
| `sqflite_common_ffi` | 2.3.6 | Base de dados SQLite |
| `sqlcipher_flutter_libs` | 0.6.1 | Criptografia SQLite com AES-256 |
| `argon2` | 1.0.1 | Hash de passwords (Argon2id) |
| `encrypt` | 5.0.3 | Criptografia AES-256 |
| `crypto` | 3.0.6 | Hash SHA-256/512 |
| `flutter_secure_storage` | 9.2.4 | Armazenamento seguro de chaves |
| `pdf` | 3.11.3 | Gera√ß√£o de relat√≥rios PDF |
| `csv` | 6.0.0 | Exporta√ß√£o para CSV |
| `fl_chart` | 1.1.1 | Gr√°ficos interativos |
| `google_fonts` | 6.3.2 | Fontes customizadas |
| `logger` | 2.6.2 | Sistema de logging seguro |
| `uuid` | 4.5.1 | Gera√ß√£o de IDs √∫nicos |

### Dependency Overrides
O projeto utiliza `dependency_overrides` para fixar vers√µes de depend√™ncias transitivas em ambientes desktop (compatibilidade com `encrypt`/SQLCipher e Flutter 3.35.x). Nota:
- Estes overrides s√£o voltados para Desktop; em Mobile, valide a matriz de vers√µes do seu target.
- Caso surjam conflitos em plataformas espec√≠ficas, ajuste as constraints no `pubspec.yaml` para o alvo desejado.
- Overrides atuais: `pointycastle: 4.0.0`, pacotes `flutter_secure_storage_*`, e pacotes base do Flutter (`characters`, `meta`, `material_color_utilities`, `test_api`).

## üèóÔ∏è Estrutura do Projeto

```
lib/
‚îú‚îÄ‚îÄ main.dart                    # Ponto de entrada da aplica√ß√£o
‚îú‚îÄ‚îÄ db/
‚îÇ   ‚îî‚îÄ‚îÄ database_helper.dart     # Gest√£o segura da base de dados
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îú‚îÄ‚îÄ user.dart                # Modelo de utilizador
‚îÇ   ‚îî‚îÄ‚îÄ incidente.dart           # Modelo de incidente
‚îú‚îÄ‚îÄ screens/
‚îÇ   ‚îú‚îÄ‚îÄ login_screen.dart        # Tela de login
‚îÇ   ‚îú‚îÄ‚îÄ dashboard_screen.dart    # Dashboard principal
‚îÇ   ‚îú‚îÄ‚îÄ form_incidente_screen.dart
‚îÇ   ‚îú‚îÄ‚îÄ perfil_screen.dart
‚îÇ   ‚îî‚îÄ‚îÄ tecnicos_screen.dart
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ auth_service.dart        # Autentica√ß√£o Argon2id (v2.1.0)
‚îÇ   ‚îú‚îÄ‚îÄ crypto_service.dart      # Criptografia AES-256
‚îÇ   ‚îú‚îÄ‚îÄ export_service.dart      # PDF/CSV criptografados
‚îÇ   ‚îú‚îÄ‚îÄ incidentes_service.dart
‚îÇ   ‚îú‚îÄ‚îÄ tecnicos_service.dart
‚îÇ   ‚îú‚îÄ‚îÄ auditoria_service.dart
‚îÇ   ‚îî‚îÄ‚îÄ detalhes_service.dart
‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îú‚îÄ‚îÄ input_sanitizer.dart     # Sanitiza√ß√£o e valida√ß√£o
‚îÇ   ‚îî‚îÄ‚îÄ secure_logger.dart       # Logging seguro
‚îî‚îÄ‚îÄ theme/
    ‚îî‚îÄ‚îÄ app_theme.dart           # Tema customizado

tools/
‚îú‚îÄ‚îÄ reset_clean.dart             # Reset da database (v2.1.0)
‚îú‚îÄ‚îÄ init_db.dart                 # Inicializar database
‚îú‚îÄ‚îÄ sync_db.dart                 # Sincroniza√ß√£o manual de DB
‚îî‚îÄ‚îÄ populate_users.dart          # Popular users de teste

## üß± Arquitetura (MVVM)

O projeto utiliza MVVM com `provider`:

- ViewModels em `lib/viewmodels/` exp√µem estado e a√ß√µes:
   - `BaseViewModel` ‚Äî estado base (loading, error)
   - `LoginViewModel` ‚Äî autentica√ß√£o e cria√ß√£o de conta
   - `DashboardViewModel` ‚Äî carregamento/filtragem de incidentes e badge de notifica√ß√µes
   - `TecnicosViewModel` ‚Äî CRUD de t√©cnicos e pesquisa
   - `FormIncidenteViewModel` ‚Äî carregamento de t√©cnicos e submiss√£o de incidentes
   - `PerfilViewModel` ‚Äî placeholder para futuras a√ß√µes de perfil
- As Views (widgets em `lib/screens/`) consomem via `context.watch()`/`read()`.
- `main.dart` envolve o app com `MultiProvider` para registrar os ViewModels.

### Par√¢metros Argon2id por plataforma (consist√™ncia)

| Plataforma | Mem√≥ria (m) | Itera√ß√µes (t) | Paralelismo (p) |
|-----------|--------------|---------------|------------------|
| Desktop   | 64 MB        | 3             | 4                |
| Android   | 32 MB        | 3             | 2                |
| iOS       | 32 MB        | 3             | 2                |

Observa√ß√µes:
- O c√≥digo atual utiliza `m=64MB, t=3, p=4` (ver `lib/services/auth_service.dart`).
- Ajuste por plataforma se necess√°rio (pode reduzir mem√≥ria/paralelismo em dispositivos m√≥veis mais modestos).
```

## üì¶ Instala√ß√£o e Configura√ß√£o

### Pr√©-requisitos
- Flutter SDK 3.35.6+
- Dart SDK 3.9.2+
- Visual Studio Build Tools 2022 (Windows)
- Git configurado com credenciais

### Instala√ß√£o

1. **Clone o reposit√≥rio**
   ```bash
   git clone https://github.com/Ferro005/Security-Report-Application.git
   cd Security-Report-Application
   ```

2. **Instale as depend√™ncias**
   ```bash
   flutter pub get
   ```

3. **Verifique o ambiente**
   ```bash
   flutter doctor
   ```

4. **Execute a aplica√ß√£o**
   ```bash
   flutter run -d windows
   ```

### Build para Produ√ß√£o

```bash
# Build otimizado
flutter build windows --release

# Execut√°vel em:
# build/windows/x64/runner/Release/gestao_incidentes_desktop.exe
```

## üîê Sistema de Autentica√ß√£o

### Configura√ß√£o Inicial

Na primeira execu√ß√£o, a aplica√ß√£o cria usu√°rios padr√£o para acesso inicial. **√â obrigat√≥rio alterar as credenciais padr√£o imediatamente ap√≥s o primeiro login por quest√µes de seguran√ßa.**

Para criar novos usu√°rios, utilize a interface administrativa ap√≥s o login ou os scripts de gest√£o em `tools/`.

Nota: Na primeira execu√ß√£o, a base de dados √© criada vazia e √© gerado apenas o utilizador administrador padr√£o (`admin@exemplo.com`). As restantes contas de teste s√≥ s√£o criadas se executar manualmente os scripts de `tools/` (por exemplo, `init_db.dart`/`populate_users.dart`).

### Seguran√ßa
- ‚úÖ Passwords protegidas com **Argon2id** (memory-hard, 64MB RAM, 3 itera√ß√µes)
- ‚úÖ Pol√≠tica de senha: expira√ß√£o (90 dias) e hist√≥rico (√∫ltimas 5) aplicados
- ‚úÖ Valida√ß√£o de senha forte m√≠nima (12+ caracteres, mai√∫sculas, min√∫sculas, n√∫meros e caractere especial)
- ‚úÖ Blacklist de senhas comuns
- ‚úÖ Prote√ß√£o contra tentativas de login excessivas (account lockout)
- ‚úÖ Auditoria completa de autentica√ß√£o
- ‚úÖ Logging seguro com mascaramento de dados sens√≠veis
- ‚úÖ Prote√ß√£o contra timing attacks
- ‚úÖ Prote√ß√£o contra SQL injection
- ‚úÖ Input sanitization em todos os campos
- ‚úÖ Database criptografada com AES-256 (SQLCipher)

## üóÑÔ∏è Base de Dados

### Localiza√ß√£o
- **Template**: Criado automaticamente na primeira execu√ß√£o
- **Runtime (Windows)**: `%USERPROFILE%\Documents\gestao_incidentes.db` (evita redire√ß√£o para OneDrive)
- **Runtime (Outros)**: Diret√≥rio de documentos da aplica√ß√£o (path_provider)
- **Nota**: Database n√£o √© versionada no Git por quest√µes de seguran√ßa

### Schema Principal

**utilizadores**
- `id`, `nome`, `email`, `hash`, `tipo`
- `failed_attempts`, `last_failed_at`, `locked_until`
- Hashes: Argon2id (v2.1.0 - production standard)

**incidentes**
- `id`, `numero`, `descricao`, `categoria`, `data_ocorrencia`
- `status`, `grau_risco`, `user_id`, `tecnico_id`

**auditoria**
- `id`, `ts`, `user_id`, `acao`, `detalhe`

### Prote√ß√µes de Seguran√ßa

1. **SQL Injection Prevention**
   - Whitelist de tabelas permitidas
   - Prepared statements em todas as queries
   - Valida√ß√£o de inputs

2. **Path Traversal Prevention**
   - Uso de `path_provider` para diret√≥rios seguros
   - Valida√ß√£o de canonical paths
   - Prote√ß√£o contra manipula√ß√£o de vari√°veis de ambiente

3. **Data Protection**
   - Exports criptografados (AES-256)
   - Logging seguro com mascaramento
   - Sanitiza√ß√£o de todos os inputs

## üñ•Ô∏è Plataformas Suportadas

- Desktop: Windows, Linux, macOS (SQLite via FFI + SQLCipher)
- Mobile: Android, iOS (SQLite nativo + SQLCipher)
- Web: Em avalia√ß√£o (armazenamento cifrado no browser requer backend alternativo). A app compila para web, mas a persist√™ncia local cifrada est√° desativada nesta vers√£o.

## üõ†Ô∏è Scripts de Gest√£o (Tools)

Principais scripts dispon√≠veis em `tools/`:

> Importante:
> - Scripts de migra√ß√£o est√£o DEPRECATED e n√£o devem ser executados. A aplica√ß√£o cria/assegura o schema automaticamente.
> - `init_db.dart` e `populate_users.dart` s√£o scripts de desenvolvimento (DEV‚Äëonly) e assumem caminhos legados (ex.: OneDrive). Prefira inicializar atrav√©s da aplica√ß√£o, que resolve `%USERPROFILE%\\Documents` de forma segura.

```bash
# Resetar database (v2.1.0 - remove todos os dados)
dart run tools/reset_clean.dart

# Inicializar database vazia (DEV‚Äëonly; legado)
dart run tools/init_db.dart

# Sincronizar DB manualmente (opcional)
dart run tools/sync_db.dart

# Popular com dados de teste (DEV‚Äëonly; legado)
dart run tools/populate_users.dart
```

**Nota**: Scripts de debug e migra√ß√£o obsoletos foram removidos na limpeza v2.1.0.

## üìä Funcionalidades Detalhadas

### Dashboard
- Listagem de incidentes com filtros (Status, Categoria, Risco)
- Busca por n√∫mero ou descri√ß√£o
- Visualiza√ß√£o de detalhes em dialog
- Atribui√ß√£o de t√©cnicos (admin)
- Estat√≠sticas e gr√°ficos
 - Painel de Notifica√ß√µes (√≠cone de sino no topo; listar, atualizar e marcar todas como lidas)

### Gest√£o de Incidentes
- Cria√ß√£o com categoriza√ß√£o (TI, RH, Infraestrutura)
- N√≠veis de risco (Baixo, M√©dio, Alto, Cr√≠tico)
- Atribui√ß√£o de t√©cnicos respons√°veis
- Controle de status (Aberto, Em Progresso, Resolvido, Fechado)
- Log de auditoria autom√°tico

### Exporta√ß√£o
- **PDF**: Relat√≥rio formatado criptografado (AES-256)
- **CSV**: Export de dados criptografado (AES-256)
- **Extens√µes**: `.pdf.encrypted` e `.csv.encrypted`
- **Decripta√ß√£o**: Use `CryptoService.decrypt()` para acessar dados

### Auditoria
- Rastreamento completo de a√ß√µes
- Timestamp autom√°tico
- Associa√ß√£o com utilizador
- Detalhes da opera√ß√£o

## üß™ Testes

```bash
# An√°lise est√°tica
dart analyze

# Testes unit√°rios
flutter test

# Build de teste
flutter build windows --debug
```

**Status Atual**: ‚úÖ Sem erros; apenas avisos de deprecia√ß√£o informativos (UI); depend√™ncias atualizadas

## üìù Qualidade de C√≥digo

- **Linter**: flutter_lints 6.0.0
- **Analysis**: Nenhum issue encontrado
- **Depreca√ß√µes**: Todas resolvidas
- **Dependencies**: 100% atualizadas (sem outdated packages)

## üîÑ Atualiza√ß√µes Recentes (Outubro 2025)

### v2.1.1 - MVVM rollout (October 28, 2025)
- ‚úÖ Ado√ß√£o de MVVM com Provider nas telas: Login, Dashboard, T√©cnicos e Formul√°rio de Incidente
- ‚úÖ Providers globais registados em `main.dart`
- ‚úÖ Documenta√ß√£o e scripts alinhados: scripts de migra√ß√£o permanecem DEPRECATED; tools de DEV marcadas como tal

### v2.1.0 - Final Cleanup & Audit (October 21, 2025)
- ‚úÖ Complete project audit (33 files verified)
- ‚úÖ Code cleanup (50+ lines of legacy code removed)
- ‚úÖ Schema alignment (all references updated)
- ‚úÖ Documentation reorganization (7 new guides created)
- ‚úÖ Build verification (0 errors, 0 warnings)
- ‚úÖ Production-ready release

### v2.0.0 - Major Security Overhaul
**Fase 1: Corre√ß√µes Cr√≠ticas**
- ‚úÖ Removida database do Git (prote√ß√£o de hashes)
- ‚úÖ Corrigido SQL injection em tableColumns()
- ‚úÖ Auto-push Git desabilitado (agora opt-in)
- ‚úÖ Scripts de debug removidos do reposit√≥rio
- ‚úÖ Path traversal corrigido (path_provider)
- ‚úÖ Exports criptografados (AES-256)
- ‚úÖ Logging seguro implementado (SecureLogger)
- ‚úÖ Valida√ß√£o de senha forte (12+ chars, especiais)
- ‚úÖ Database criptografada com SQLCipher

**v2.1.0 - Final Release**
- ‚úÖ Auditoria completa de seguran√ßa
- ‚úÖ Migra√ß√£o Argon2id completa (64MB RAM, 3 itera√ß√µes, 4 threads)
- ‚úÖ Remo√ß√£o de scripts de debug (ferramentas obsoletas)
- ‚úÖ Schema de dados alinhado e validado
- ‚úÖ Documenta√ß√£o sincronizada
- ‚úÖ Build release sem erros (0 warnings)

**Score de Seguran√ßa**: 62/100 ‚Üí **91/100**

### Documenta√ß√£o Dispon√≠vel
- üìÑ `SECURITY_AUDIT.md` - Relat√≥rio de auditoria (atualizado com v2.1.0)
- üìÑ `SECURITY_IMPROVEMENTS.md` - Melhorias de seguran√ßa (estado e pr√≥ximos passos)
- üìÑ `SECURITY_IMPROVEMENTS_IMPLEMENTATION.md` - Detalhes de implementa√ß√£o v2.1.0
- üìÑ `SESSION_COMPLETION_REPORT.md` - Resumo final da sess√£o
 - üìÑ `docs/security/jwt_policy.md` - Pol√≠tica de sess√µes JWT (lifetime, refresh, rota√ß√£o)
 - üìÑ `docs/security/data_at_rest_sqlcipher.md` - Dados em repouso (SQLCipher/KDF, PRAGMAs)

## ü§ù Contribuindo

1. Fork o projeto
2. Crie uma branch para sua feature (`git checkout -b feature/AmazingFeature`)
3. Commit suas mudan√ßas (`git commit -m 'Add some AmazingFeature'`)
4. Push para a branch (`git push origin feature/AmazingFeature`)
5. Abra um Pull Request

## üìÑ Licen√ßa

Este projeto est√° sob licen√ßa propriet√°ria. Todos os direitos reservados.

## üë®‚Äçüíª Autores

**Henrique Carvalho** - [Henryu1781](https://github.com/Henryu1781)
**Gon√ßalo Ferro** - [Ferro005](https://github.com/Ferro005)

## üîó Links √öteis

- [Reposit√≥rio GitHub](https://github.com/Ferro005/Security-Report-Application)
- [SECURITY_AUDIT.md](SECURITY_AUDIT.md) - Relat√≥rio Final de Seguran√ßa
- [Flutter Documentation](https://docs.flutter.dev/)
- [SQLite Documentation](https://www.sqlite.org/docs.html)
- [SQLCipher Documentation](https://www.zetetic.net/sqlcipher/)
- [Argon2 RFC 9106](https://datatracker.ietf.org/doc/html/rfc9106)
- [OWASP Password Storage](https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html)

---

**Status do Projeto**: ‚úÖ Production | üîí Hardened | üì¶ v2.1.1 | üèÜ 91/100 Security Score

*√öltima atualiza√ß√£o: 28 de Outubro de 2025*
